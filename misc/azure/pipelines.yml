name: $(SourceBranchName)-$(Rev:.r)

variables:
  EXEC_CONTAINER: false

trigger:
  batch: true
  paths:
    exclude:
      - cmd/pipehub/pipehub.sample.hcl
      - misc/docker/build/entrypoint.sh
      - misc/docker/ci/tools.json
      - .gitignore
      - .goreleaser.yml
      - changelog.md
      - license
      - readme.md

jobs:
  - job: 'quality:go-test'
    container: pipehub/ci:1
    pool:
      vmImage: Ubuntu 16.04
    displayName: Quality | Go Test
    steps:
      - script: make go-test

  - job: 'quality:go-linter'
    container: pipehub/ci:1
    pool:
      vmImage: Ubuntu 16.04
    displayName: Quality | Go Linter
    steps:
      - script: make go-linter

  - job: 'quality:go-linter-vendor'
    container: pipehub/ci:1
    pool:
      vmImage: Ubuntu 16.04
    displayName: Quality | Go Linter Vendor
    steps:
      - script: make go-linter-vendor

  - job: 'quality:docker-linter'
    container: pipehub/ci:1
    pool:
      vmImage: Ubuntu 16.04
    displayName: Quality | Docker Linter
    steps:
      - script: make docker-linter

  - job: 'build:go'
    container: pipehub/ci:1
    pool:
      vmImage: Ubuntu 16.04
    displayName: Build | Go
    steps:
      - script: go build -mod readonly -o bin/pipehub/pipehub cmd/pipehub/*.go
  # - job: job2
  #   container: pipehub/ci:1
  #   pool:
  #     vmImage: Ubuntu 16.04
  #   displayName: 'Test'
  #   steps:
  #     - script: make go-test
  # - job: job3
  #   container: pipehub/ci:1
  #   pool:
  #     vmImage: Ubuntu 16.04
  #   displayName: 'Linter'
  #   steps:
  #     - script: make go-linter
  # - job: job4
  #   container: pipehub/ci:1
  #   pool:
  #     vmImage: Ubuntu 16.04
  #   displayName: 'Linter Vendor'
  #   steps:
  #     - script: make go-linter-vendor
  # - job: job5
  #   container: pipehub/ci:1
  #   pool:
  #     vmImage: Ubuntu 16.04
  #   displayName: 'Linter'
  #   steps:
  #     - script: make docker-linter
